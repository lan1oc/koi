# Koi - 多功能信息收集与处理工具

# 闲来无事
老是碰到大量重复性的工作，想着让ai写个工具能够简化一下我的操作，并且也结合了以前写的一些工具，集成了一下

## 项目简介

Koi 是一个集成了多种功能的桌面应用程序，主要用于信息收集、威胁情报分析、文档处理等安全相关工作。

## 主要功能

### 🔍 信息收集
- **威胁情报查询**：支持 IP、域名、文件哈希等威胁情报查询
- **企业信息查询**：集成多个企业信息查询平台
- **资产映射**：网络资产发现和映射功能

### 📄 文档处理
- **文档转换**：Word 转 PDF、PDF 提取等
- **报告重写**：智能报告内容重写功能

### 🛠️ 数据处理
- **Excel 处理**：数据填充、字段提取等
- **模板管理**：支持自定义数据处理模板

### 🚨 应急响应
- **周报生成**：自动化周报生成工具

## 安装和使用

### 环境要求
- Python 3.8+
- PyQt6
- 其他依赖见 `requirements.txt`

### 安装步骤

1. 克隆项目
```bash
git clone <your-repo-url>
cd wow
```

2. 安装依赖
```bash
pip install -r requirements.txt
```

3. 配置设置
```bash
# 复制配置模板
cp config_template.json config.json
# 编辑 config.json 添加你的 API 密钥
```

4. 运行程序
```bash
python koi.py
```

或者直接通过编译吧

## 配置说明

程序需要配置各种 API 密钥才能正常工作：

- **Hunter API**：用于网络资产查询
- **Quake API**：用于网络空间测绘
- **FOFA API**：用于网络资产搜索
- **威胁情报 API**：用于威胁情报查询
- **企业查询 Cookie**：用于企业信息查询（天眼查、爱企查）

请参考 `config_template.json` 文件进行配置，直接把`config_template.json`改成`config.json`也行，程序内都能设置api

# 数据处理
## 字段提取
测试文件如下
![](自研/Pasted%20image%2020251022101956.png)
选择文件后，会识别分隔符，如果识别不到可以手动设置，然后自动读取表头信息
![](自研/Pasted%20image%2020251022101916.png)
比如提取url和公司
![](自研/Pasted%20image%2020251022103311.png)
文件如下
![](自研/Pasted%20image%2020251022103329.png)
## 数据填充
这个功能就是服务于前面的，提取后的数据填充到对应的模板上面
源文件就是提取后的数据文件，然后再选个模板文件
比如模板文件是这样
![](自研/Pasted%20image%2020251022104731.png)
选好文件后，然后要选择映射
![](自研/Pasted%20image%2020251022110341.png)
然后点启用映射就行，映射情况如下
![](自研/Pasted%20image%2020251022111732.png)
开始填充
![](自研/Pasted%20image%2020251022111806.png)
填充好之后
![](自研/Pasted%20image%2020251022112715.png)
![](自研/Pasted%20image%2020251022112257.png)
## 模板管理
这个就是之前数据填充那边，将映射关系保存为模板之后查看的地方
界面如下
![](自研/Pasted%20image%2020251022112953.png)
模板信息
![](自研/Pasted%20image%2020251022112936.png)
# 信息收集
## 企业查询
### 天眼查
抓个cookie，记得得网页先查一下，身份验证通过以后就行了
![](自研/Pasted%20image%2020251016103003.png)
批量最多能查多少还不知道，最多的的是，一次性查了77家，然后没被ban
![](自研/Pasted%20image%2020250918153313.png)
### 爱企查
抓个cookie直接查，而且cookie可用时间很久啊，半个多月了，具体忘了，反正挺久
能查地址、注册号、备案号、资产主域名、员工联系方式（不保真，就是爱企查那边更多手机号的信息）
![](自研/Pasted%20image%2020251016092133.png)

## 资产测绘
### fofa(图一乐，api不能免费用先写着，以后要花钱了再完善)
就是根据fofa的[api文档](https://fofa.info/api)写的
![](自研/Pasted%20image%2020251022092250.png)
然后测试请求和响应
![](自研/Pasted%20image%2020251022092323.png)
现在貌似是更新了，我记得以前好像有直接给python的实例代码
影响不大，根据这个curl命令的请求用`request`模块也能直接写了，这里主要是看响应的内容，毕竟要做一下数据格式化
然后界面是这个效果
![](自研/Pasted%20image%2020251022091952.png)
### hunter
同样也是根据api文档写，思路和fofa那边一样
界面这样
![](自研/Pasted%20image%2020251022092803.png)
查询之后的数据显示
![](自研/Pasted%20image%2020251022092846.png)
然后导出，有以下几种格式可选
![](自研/Pasted%20image%2020251022092912.png)
比如导出成txt，格式如下
![](自研/Pasted%20image%2020251022093000.png)
感觉有点乱，但实际都是很列分好的，可以用之前数据处理那边的提取功能，把想要的字段提取出来，合成一个新文件用
### 360quake
他的界面以及查询后的数据显示是
![](自研/Pasted%20image%2020251022093238.png)
本来我看就是网页版查是有显示备案号和备案主体这两列的，但是我用api查一直不显示，我以为是代码问题，后来就是用curl命令测试了一下，发现这两个字段返回的是空值，并且网页上，这两列也置空，多此一举了属于是
![](自研/Pasted%20image%2020251022093552.png)
### 语法文档和统一查询
设置了语法文档和统一查询功能，语法文档我是直接把api文档喂给ai写的，所以有点不全但是日常基本使用还是能直接查的
![](自研/Pasted%20image%2020251022093756.png)
![](自研/Pasted%20image%2020251022093807.png)
![](自研/Pasted%20image%2020251022093819.png)
![](自研/Pasted%20image%2020251022093824.png)
统一查询界面是这样
![](自研/Pasted%20image%2020251022093853.png)
写了个简单的语句转换逻辑，可以一次查询调用三个平台（理论上，实际实验测试都是用hunter和360quake）
![](自研/Pasted%20image%2020251022094845.png)
![](自研/Pasted%20image%2020251022094859.png)
![](自研/Pasted%20image%2020251022094908.png)
导出后自带去重，哦好像去重逻辑没怎么写好，多了比较多无意义的行
![](自研/Pasted%20image%2020251022094951.png)
## 威胁情报
根据微步的api写的，但是比较鸡肋，md基本有用的功能都不让你免费用
### ip信誉
查询完的界面如下
![](自研/Pasted%20image%2020251022153213.png)
最后面这个查看详情按钮点击后可以跳到IP对应的情报查询结果页链接
![](自研/Pasted%20image%2020251022153237.png)
![](自研/Pasted%20image%2020251022153306.png)
### 域名失陷检测

查询结果如下

![域名失陷检测结果](自研/Pasted%20image%2020251022155037.png)

### 文件分析

#### 哈希查询

界面如下

![哈希查询界面](自研/Pasted%20image%2020251022170725.png)

查询结果

![哈希查询结果](自研/Pasted%20image%2020251023101908.png)

可以直接看详情或者打开报告

![查询详情](自研/Pasted%20image%2020251023102005.png)

![打开报告](自研/Pasted%20image%2020251023102017.png)

还有单纯的多引擎检测

![多引擎检测](自研/Pasted%20image%2020251023102050.png)

#### 文件上传

界面如下

![文件上传界面](自研/Pasted%20image%2020251022171029.png)

查询结果

![文件上传查询结果](自研/Pasted%20image%2020251022171036.png)

打开报告

![文件上传报告](自研/Pasted%20image%2020251022171049.png)

详情

![文件上传详情](自研/Pasted%20image%2020251023102203.png)
# 江湖救急
## 周报生成
界面长这样
![](自研/Pasted%20image%2020251016092114.png)
运行结果
![](自研/Pasted%20image%2020251016092057.png)
大致原理：
最初想法是，`win+tab`快捷键能看到打开的历史文件数据，他的数据来源是Windows活动历史数据库，然后就会遇到一些问题 ：
- SQLite数据库结构复杂 ：微软没有公开完整的数据库架构文档
- 表结构经常变化 ：Windows更新时数据库结构可能改变
- 数据关联复杂 ：需要关联多个表才能获取完整信息
- 二进制数据 ：部分字段存储为二进制格式，需要特殊解析
- API限制
	Microsoft Graph API ：
	- 需要Azure AD应用注册
	- 需要企业级权限
	- 个人用户难以获取必要的API密钥
	- 有严格的调用频率限制
	Windows Runtime API ：
	- 主要面向UWP应用
	- Python调用复杂，需要额外的COM组件
	- 功能有限，无法获取详细的文件信息
那就替换方案，改成读取注册表 + 最近文件夹 + 文件系统，这样好操作
# 文档处理
## 网信办通报改写
进行区网信办的通报文件改写
唉，驻场的本职工作，但是太几把枯燥无味和繁琐了，流程都是重复的，就按照流程然后写成工具自动化改写了
有时候会遇到一些bug，成因是com接口调用繁忙，上一次调用的句柄还未释放，然后就已经到下个通报改写的调用了，就会造成图片插入失败
![](自研/Pasted%20image%2020251016091243.png)
但其实印象不是不大，毕竟本身这个操作就是需要我手动微调的，不过也分两种情况
1. 文档里没有插入设置为`浮于文字上方`的盖章样式图片
2. 插入了但没保存，打开后要另存为才行，如下图所示
![](自研/Pasted%20image%2020251016101421.png)
然后就是微调完，点击转换pdf的按钮，那个就是专门转换通报的
![](自研/Pasted%20image%2020251016102648.png)
## word转pdf
界面如下
![](自研/Pasted%20image%2020251023102302.png)
## pdf提取
提取pdf用的，界面如下
![](自研/Pasted%20image%2020251023102328.png)
预览
![](自研/Pasted%20image%2020251023102433.png)


